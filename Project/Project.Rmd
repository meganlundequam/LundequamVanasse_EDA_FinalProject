---
output: 
  pdf_document:
    keep_tex: yes
    fig_caption: yes
    number_sections: yes
geometry: margin=2.54cm
title: "Energy Distribution in North Carolina"
subtitle: "https://github.com/meganlundequam/LundequamVanasse_EDA_FinalProject"
author: "Megan Lundequam, Casey Slaught, Sam Vanasse"
fontsize: 12pt
mainfont: Times New Roman

---

RMarkdown Cheat Sheet: https://www.rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf


\newpage
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

```{r setup, include=FALSE}
# Set your working directory
library(scales)
library(sf)
library(tidyverse)
library(plyr)
library(tidycensus)
library(tidyr)
options(tigris_use_cache = TRUE)
library(dplyr)
library(lubridate)
library(corrplot)


# Load your packages

# Set your ggplot theme
theme_set(theme_classic())

# Load your datasets
censusData = st_read("../Data/Processed/NC_county_complete.geojson")
```


# Rationale and Research Questions

Awareness of environmental injustice has been prevalent in North Carolina for decades. In fact, Warren County, a county just north of Durham, is widely recognized as the birthplace of today’s environmental justice movement. In the late 1980s, the National Association for the Advancement of Colored People and others staged a protest against the state of North Carolina’s decision to site a hazardous waste landfill in the predominantly colored county. Although the protests failed to prevent the siting of the disposal facility, the event shed light on environmental injustice trends with the EPA describing the movement in its 1994 Environmental Equity Draft as “the watershed event that led to the environmental equity movement of the 1980’s.”

In North Carolina and across the US, a common expression of environmental injustice is the disproportionate amount of locally unwanted land uses sited next to low income and minority communities. An example of such a land use is energy production. The largest source of energy in the U.S. is fossil fuels and the burning of fossil fuels at power plants created emissions that can lead to respiratory and cardiovascular problems and increase the possibility of health issues ranging from cancer to immune system damage. Minority, low-income, and indigenous populations frequently bear a disproportionate burden of these environmental harms and adverse health outcomes as a result of these siting trends.

Due to a growing awareness of this trend and actions to combat environmental injustice across the U.S., it is necessary to examine the present day correlation of energy generators and minority, low income communities. This analysis explores the present day distribution of utilities in relation to the distribution of low income communities to investigate to what extent this correlation still exists. This analysis further explores if that trend is true for different energy types. We were interested to see if there was any difference in the distribution of fossil fuel based utilities versus that of renewable energy sources in relation to minority and low income communities. 

## Research Questions:

This study examines the following key questions:

### Question 1: Are energy production utilities in North Carolina located closer to low-income communities?

### Question 2: Does the location of energy production utilities vary according to energy type? i.e., do different types of utilities have differing degrees of correlation with low income and minority communities?


\newpage

# Dataset Information

The data used for this analysis falls into two categories, energy related data and demographic data. We derived energy related data from the US Energy Information Association and specifically focused on the location of energy production plants, the number of generators at those plants, the type of fuel used, and the nameplate capacity of the generators, a variable that represents the generator's maximum generation capacity in megawatts.
[explain how we wrangled]

We derived demographic data from the US Census Bureau and specifically looked at the variables representing median household income by county, ___________.
[explain how we wrangled]

\newpage

# Exploratory Analysis

There is a marked difference in median household income across counties in North Carolina.

```{r, echo=FALSE, message=FALSE, fig.height=9}

ggplot(censusData[censusData$Year==2020,], 
       aes(x=MedianFamilyIncome, y=reorder(CountyShort, MedianFamilyIncome))) +
  geom_point() + 
  scale_x_continuous(labels=comma) + 
  labs(x="Median Household Income", y="NC Counties") + 
  theme(text = element_text(size = 8))

```

Energy generators are diverse in type and widespread throughout the state. Yet while solar appears to be the most abundant, it makes up small fraction of total energy generation.

```{r, echo=FALSE, results='hide', fig.height=7, fig.width=10}

generators = st_read("../Data/Processed/generatorsFuelType.geojson")

ggplot() + 
  geom_sf(aes(fill=MedianFamilyIncome), data=censusData) + 
  geom_sf(aes(color=FuelType), alpha=0.6, size=3, data=generators) + 
  scale_y_continuous(labels=comma) + 
  scale_fill_gradient(labels=comma) + 
  scale_color_manual(values=c(
    "Coal" = "#9c0310",
    "Petroleum Product" = "#e00b8b",
    "Natural Gas" = "#d49a08",
    "Gaseous Renewable Fuel" = "#edc600",
    "Energy Storage" = "#8f8f8f",
    "Liquid Renewable Fuel" = "#aed100",
    "Nuclear" = "#870ee3", 
    "Gaseous Renewable Fuel" = "#778a3f",
    "Hydroelectric" = "#147aff",
    "Solid Renewable Fuel" = "#465e00",
    "Waste Heat" = "#46998d",
    "Solar" = "#00ff7b",
    "Wind" = "#80a6ff"
    )
  ) + 
  labs(color="Generator Type", fill="Median Household Income") + 
  theme_void() 

```

The following bar charts show that although there is a greater number of generators generating renewable energy across the state of North Carolina, the majority of energy production (represented by nameplate capacity) comes from fossil fuel sources.

``` {r}
full.data.gen <- read.csv("../Data/Processed/NCGenerator&Income.csv")

## Plot - number of generators by fuel type
Renewable.v.ff.gen <-
  ggplot(data = full.data.gen, mapping = aes(x = FuelType, fill = Renewable.v.FossilFuel)) +
  geom_bar() +
  labs(title = "Number of Generators by Fuel Type",
       y = "Count", x = "Energy Generation Type") +
  theme(axis.text.x = element_text(angle = 45,  hjust = 1))
print(Renewable.v.ff.gen)

aggregated.gen.data.2 <- read.csv("../Data/Processed/NPCapByFuelType.csv")

## Plot - nameplate capacity by fuel type
Renewable.v.ff.cap <-
  ggplot(data = aggregated.gen.data.2) +
  geom_col(mapping = aes(x = FuelType, y = total.np.cap, fill = Renewable.v.FossilFuel)) +
  labs(title = "Nameplate Capacity by Fuel Type",
       y = "Nameplate Capacity (MW)", x = "Energy Generation Type") +
  theme(axis.text.x = element_text(angle = 45,  hjust = 1))
print(Renewable.v.ff.cap)
```

\newpage

# Analysis


```{r include=FALSE}
## Adding new census info and cleaning it
additional.census <- read.csv("../Data/Processed/UpdatedCensus.csv", stringsAsFactors = TRUE) 
additional.census <- 
  additional.census %>%
  subset(select=c(County, TotalPopulation, NoSchooling, Mobility, RaceAllocation, DetailedRace)) %>%
  rename(c("PovertyMobility" = Mobility, "WhitePopMobility" = RaceAllocation, "CollegeDeg" = DetailedRace)) %>%
  mutate(Per.PovertyMobility = (PovertyMobility/TotalPopulation),
         MinorityMobility = (TotalPopulation - WhitePopMobility),
         Per.MinorityMobility = (MinorityMobility/TotalPopulation),
         Per.NoSchooling = (NoSchooling/TotalPopulation),
         Per.CollegeDeg = (CollegeDeg/TotalPopulation)
         )

## Generator Info
census.data <- read.csv("../Data/Processed/generatorsCensusCategoriesComplete.csv", stringsAsFactors = TRUE)
census.data <- 
  full_join(census.data, additional.census) %>%
  drop_na(Energy.Source.1)

## Getting nameplate capacity
generator.data <- read.csv("../Data/2020EnergyData/3_1_Generator_Y2020.csv", stringsAsFactors = TRUE)

## Selecting variables of interest
generator.data <- 
  generator.data %>%
  subset(generator.data$State == "NC") %>%
  subset(select = c(County, Plant.Code, Prime.Mover, Nameplate.Capacity..MW.))

## Adding income to the full generator data by county
full.data <- cbind(census.data, generator.data$Nameplate.Capacity..MW.) %>% 
  rename(c("Nameplate.Capacity" = `generator.data$Nameplate.Capacity..MW.`)) %>% 
  mutate(Nameplate.Capacity1 = as.numeric(as.character(Nameplate.Capacity)))

```


```{r include=FALSE}
## Aggregating the generator data so that it groups all of it by county and by generation type
aggregated.gen.data <- 
  full.data %>%
  group_by(County, Renewable.v.FossilFuel) %>%
  dplyr::summarise(energy.type.gen = sum(Nameplate.Capacity1))

## Joining it to the census data to have capacity and income in same file & selecting specific variables
processed.gen.census <- 
  full_join(aggregated.gen.data, census.data) %>%
  subset(select=c(County, Renewable.v.FossilFuel, energy.type.gen, MedianHouseholdIncome, TotalPopulation, Per.CollegeDeg, Per.PovertyMobility, Per.MinorityMobility, Per.NoSchooling)) %>%
  distinct(.keep_all = TRUE)

## Creating a total generation variable, Removing fossil vs renewable distinction
total.gen.census <- 
  processed.gen.census %>%
  group_by(County) %>%
  dplyr::summarise(total.gen = sum(energy.type.gen))

##Separating into 3 different data sets to analyze different impacts
Final.gen.census <-
  full_join(processed.gen.census, total.gen.census) 

Renewable.county <- 
  Final.gen.census %>%
  subset(Renewable.v.FossilFuel=='Renewable Fuel') 

Fossil.county <- 
  Final.gen.census %>%
  subset(Renewable.v.FossilFuel=='Fossil Fuel') 
```


```{r echo=FALSE}
## Correlation Plot
Corr.data <- 
  Renewable.county %>%
  select(MedianHouseholdIncome:total.gen) %>%
  na.omit() %>%
  subset(select=-c(County))

corrplot(Corr.data, method = "ellipse")
corrplot.mixed(Corr.data, upper = "ellipse")

## All variable Regression
total.regression.variables <- 
  lm(data = Final.gen.census, log(total.gen) ~ log(MedianHouseholdIncome) + 
       Per.CollegeDeg + Per.PovertyMobility + 
       Per.MinorityMobility)
fossil.reg.variables <- 
  lm(data = Fossil.county, log(energy.type.gen) ~ log(MedianHouseholdIncome) + 
       Per.CollegeDeg + Per.PovertyMobility + 
       Per.MinorityMobility)
renewable.reg.variables <- 
  lm(data = Renewable.county, log(energy.type.gen) ~ log(MedianHouseholdIncome) + 
       Per.CollegeDeg + Per.PovertyMobility + 
       Per.MinorityMobility)

## AIC
step(regression.variables)
step(fossil.reg.variables)
step(renewable.reg.variables)

## Regression Analysis
renewable.reg <- 
  lm(data = Renewable.county, log(energy.type.gen) ~ log(MedianHouseholdIncome) + 
        Per.MinorityMobility)
summary(renewable.reg)


total.energy.reg <- 
  lm(data = Final.gen.census, log(total.gen) ~ log(MedianHouseholdIncome) + 
       Per.CollegeDeg + Per.PovertyMobility + 
       Per.MinorityMobility)
summary(total.energy.reg)

fossil.reg <- 
  lm(data = Fossil.county, log(energy.type.gen) ~ log(MedianHouseholdIncome) + 
       Per.CollegeDeg + Per.PovertyMobility + 
       Per.MinorityMobility)
summary(fossil.reg)




plot(renewable.reg)


```


For this analysis we used the generation site's nameplate capacity as the 
independent variable demonstrating the size, and assumed impact, to a community. 
We aggregated these values into three broad categories: fossil fuel, renewable, 
and total energy generation in each county. We then combined this data with 
demographic data from the US Census Bureau for the year 2020. These dependent 
variables include the county's median income, the percent of the county's total 
population that have received a college or associates degree, and the mobility
of the population based on race and poverty status. 

Given that both total energy generation within a county and their median income
are positively skewed, we used log transformation on those variables. The 
remaining dependent variables were not log transformed as we already converted 
them to percentages of each county's total population. 

To help narrow the focus of our analysis we utilized Akaike's Information 
Criterion (AIC) to select our variables for each regression. This exploratory 
analysis demonstrated that, given our data limitations, focusing on renewable
data and using our minority mobility and median income variables will offer the 
best analysis (AIC=21.31).

The regression analysis (Adj. R-squared = 0.1638) demonstrates with a 1% 
increase in a county's renewable energy infrastructure, the county's median 
income decreases by 1.51% (p-value = 0.0329) and the ratio of population that 
is a minority increases by 1.97% (p-value = 0.0117). This is in line with what 
we hypothesized, because although renewable energy is often thought of as a 
luxury resource, the infrastructure still undergoes NIMBY criticism by many 
wealthier individuals. 



\newpage

# Summary and Conclusions


\newpage

# References
<add references here if relevant, otherwise delete this section> 
