---
output: 
  pdf_document:
    keep_tex: yes
    fig_caption: yes
    number_sections: yes
geometry: margin=2.54cm
title: "Energy Distribution in North Carolina"
subtitle: "https://github.com/meganlundequam/LundequamVanasse_EDA_FinalProject"
author: "Megan Lundequam, Casey Slaught, Sam Vanasse"
fontsize: 12pt
mainfont: Times New Roman

---

RMarkdown Cheat Sheet: https://www.rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf


\newpage
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

```{r setup, include=FALSE}
# Set your working directory
library(scales)
library(sf)
library(tidyverse)

# Load your packages

# Set your ggplot theme
theme_set(theme_classic())

# Load your datasets
censusData = st_read("../Data/Processed/NC_county_complete.geojson")
```


# Rationale and Research Questions



\newpage

# Dataset Information



\newpage

# Exploratory Analysis

There is a marked difference in median household income across counties in North Carolina.

```{r, echo=FALSE, message=FALSE, fig.height=9}

ggplot(censusData[censusData$Year==2020,], 
       aes(x=MedianFamilyIncome, y=reorder(CountyShort, MedianFamilyIncome))) +
  geom_point() + 
  scale_x_continuous(labels=comma) + 
  labs(x="Median Household Income", y="NC Counties") + 
  theme(text = element_text(size = 8))

```

Energy generators are diverse in type and widespread throughout the state. Yet while solar appears to be the most abundant, it makes up small fraction of total energy generation.

```{r, echo=FALSE, results='hide', fig.height=7, fig.width=10}

generators = st_read("../Data/Processed/generatorsFuelType.geojson")

ggplot() + 
  geom_sf(aes(fill=MedianFamilyIncome), data=censusData) + 
  geom_sf(aes(color=FuelType), alpha=0.6, size=3, data=generators) + 
  scale_y_continuous(labels=comma) + 
  scale_fill_gradient(labels=comma) + 
  scale_color_manual(values=c(
    "Coal" = "#9c0310",
    "Petroleum Product" = "#e00b8b",
    "Natural Gas" = "#d49a08",
    "Gaseous Renewable Fuel" = "#edc600",
    "Energy Storage" = "#8f8f8f",
    "Liquid Renewable Fuel" = "#aed100",
    "Nuclear" = "#870ee3", 
    "Gaseous Renewable Fuel" = "#778a3f",
    "Hydroelectric" = "#147aff",
    "Solid Renewable Fuel" = "#465e00",
    "Waste Heat" = "#46998d",
    "Solar" = "#00ff7b",
    "Wind" = "#80a6ff"
    )
  ) + 
  labs(color="Generator Type", fill="Median Household Income") + 
  theme_void() 

```

\newpage

# Analysis
```{r}
## Adding new census info and cleaning it
additional.census <- read.csv("../Data/Processed/UpdatedCensus.csv", stringsAsFactors = TRUE) 
additional.census <- 
  additional.census %>%
  subset(select=c(County, TotalPopulation, NoSchooling, Mobility, RaceAllocation, DetailedRace)) %>%
  rename(c("PovertyMobility" = Mobility, "WhitePopMobility" = RaceAllocation, "CollegeDeg" = DetailedRace)) %>%
  mutate(Per.PovertyMobility = (PovertyMobility/TotalPopulation),
         MinorityMobility = (TotalPopulation - WhitePopMobility),
         Per.MinorityMobility = (MinorityMobility/TotalPopulation),
         Per.NoSchooling = (NoSchooling/TotalPopulation),
         Per.CollegeDeg = (CollegeDeg/TotalPopulation)
         )

## Generator Info
census.data <- read.csv("../Data/Processed/generatorsCensusCategoriesComplete.csv", stringsAsFactors = TRUE)
census.data <- 
  full_join(census.data, additional.census) %>%
  drop_na(Energy.Source.1)

## Getting nameplate capacity
generator.data <- read.csv("../Data/2020EnergyData/3_1_Generator_Y2020.csv", stringsAsFactors = TRUE)

## Selecting variables of interest
generator.data <- 
  generator.data %>%
  subset(generator.data$State == "NC") %>%
  subset(select = c(County, Plant.Code, Prime.Mover, Nameplate.Capacity..MW.))

## Adding income to the full generator data by county
full.data <- cbind(census.data, generator.data$Nameplate.Capacity..MW.) %>% 
  rename(c("Nameplate.Capacity" = `generator.data$Nameplate.Capacity..MW.`)) %>% 
  mutate(Nameplate.Capacity1 = as.numeric(as.character(Nameplate.Capacity)))

```


```{r}
## Aggregating the generator data so that it groups all of it by county and by generation type
aggregated.gen.data <- 
  full.data %>%
  group_by(County, Renewable.v.FossilFuel) %>%
  dplyr::summarise(energy.type.gen = sum(Nameplate.Capacity1))

## Joining it to the census data to have capacity and income in same file & selecting specific variables
processed.gen.census <- 
  full_join(aggregated.gen.data, census.data) %>%
  subset(select=c(County, Renewable.v.FossilFuel, energy.type.gen, MedianHouseholdIncome, TotalPopulation, Per.CollegeDeg, Per.PovertyMobility, Per.MinorityMobility, Per.NoSchooling)) %>%
  distinct(.keep_all = TRUE)

## Creating a total generation variable, Removing fossil vs renewable distinction
total.gen.census <- 
  processed.gen.census %>%
  group_by(County) %>%
  dplyr::summarise(total.gen = sum(energy.type.gen))

##Separating into 3 different data sets to analyse different impacts
Final.gen.census <-
  full_join(processed.gen.census, total.gen.census) 

Renewable.county <- 
  Final.gen.census %>%
  subset(Renewable.v.FossilFuel=='Renewable Fuel') 

Fossil.county <- 
  Final.gen.census %>%
  subset(Renewable.v.FossilFuel=='Fossil Fuel') 
```

```{r}
## Correlation Plot
Corr.data <- 
  Renewable.county %>%
  select(MedianHouseholdIncome:total.gen) %>%
  na.omit() %>%
  subset(select=-c(County))

corrplot(Corr.data, method = "ellipse")
corrplot.mixed(Corr.data, upper = "ellipse")

## All variable Regression
regression.variables <- 
  lm(data = Final.gen.census, log(total.gen) ~ log(MedianHouseholdIncome) + 
       Per.CollegeDeg + Per.PovertyMobility + 
       Per.MinorityMobility)

## AIC
step(regression.variables)

## Regression Analysis
total.energy.reg <- 
  lm(data = Final.gen.census, log(total.gen) ~ log(MedianHouseholdIncome) + 
       Per.CollegeDeg + Per.PovertyMobility + 
       Per.MinorityMobility)
summary(total.energy.reg)


fossil.reg <- 
  lm(data = Fossil.county, log(energy.type.gen) ~ log(MedianHouseholdIncome) + 
       Per.CollegeDeg + Per.PovertyMobility + 
       Per.MinorityMobility)
summary(fossil.reg)

renewable.reg <- 
  lm(data = Renewable.county, log(energy.type.gen) ~ log(MedianHouseholdIncome) + 
       Per.CollegeDeg + Per.PovertyMobility + 
       Per.MinorityMobility)
summary(renewable.reg)


plot(renewable.reg)
plot(total.energy.reg)
plot(fossil.reg)

```


## Question 1: <insert specific question here and add additional subsections for additional questions below, if needed>

## Question 2: 




\newpage

# Summary and Conclusions


\newpage

# References
<add references here if relevant, otherwise delete this section> 
